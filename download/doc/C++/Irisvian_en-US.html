<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Face Search V1.0(TrialFaceSDK)Capability IntroductionInterface Capability Face Search: Search a given face from image library, return topK most similar faces.Dependencied CPU: MSVCP140、VCRUNTIME140Use">
<meta property="og:type" content="website">
<meta property="og:title" content="GlasssixResearch">
<meta property="og:url" content="https://glasssix.github.io/download/doc/C++/Irisvian_en-US.html">
<meta property="og:site_name" content="GlasssixResearch">
<meta property="og:description" content="Face Search V1.0(TrialFaceSDK)Capability IntroductionInterface Capability Face Search: Search a given face from image library, return topK most similar faces.Dependencied CPU: MSVCP140、VCRUNTIME140Use">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-03-31T09:37:27.405Z">
<meta property="article:modified_time" content="2019-06-21T16:31:29.000Z">
<meta property="article:author" content="GlasssixResearch">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://glasssix.github.io/download/doc/C++/Irisvian_en-US.html"/>





  <title> | GlasssixResearch</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
   

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">GlasssixResearch</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-technology-share">
          <a href="/share/" rel="section">
            
            Technology Share
          </a>
        </li>
      
        
        <li class="menu-item menu-item-membership">
          <a href="/categories/" rel="section">
            
            Membership
          </a>
        </li>
      
        
        <li class="menu-item menu-item-download">
          <a href="/download/" rel="section">
            
            Download
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about-us">
          <a href="/about/" rel="section">
            
            About Us
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>
<a href="https://github.com/Glasssix" class="github-corner" target="_blank" title="Follow me on GitHub" aria-label="Follow me on GitHub">
      <svg width="60" height="60" viewBox="0 0 250 250" style="fill:#222; color:#fff; position: fixed; top: 0; border: 0; right: -7px;" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
    <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
      </svg>
</a>
    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    
    
    
    <div class="post-block page">
      <header class="post-header">

	<h1 class="post-title" itemprop="name headline"></h1>



</header>

      
      
      
      <div class="post-body">
        
        
          <h2 id="Face-Search-V1-0-TrialFaceSDK"><a href="#Face-Search-V1-0-TrialFaceSDK" class="headerlink" title="Face Search V1.0(TrialFaceSDK)"></a>Face Search V1.0(TrialFaceSDK)</h2><h3 id="Capability-Introduction"><a href="#Capability-Introduction" class="headerlink" title="Capability Introduction"></a>Capability Introduction</h3><h4 id="Interface-Capability"><a href="#Interface-Capability" class="headerlink" title="Interface Capability"></a>Interface Capability</h4><ul>
<li><strong>Face Search</strong>: Search a given face from image library, return topK most similar faces.<h4 id="Dependencied"><a href="#Dependencied" class="headerlink" title="Dependencied"></a>Dependencied</h4></li>
<li><strong>CPU</strong>: MSVCP140、VCRUNTIME140<h3 id="Use-Cases"><a href="#Use-Cases" class="headerlink" title="Use Cases"></a>Use Cases</h3></li>
</ul>
<ol>
<li><p>Size of image library equals 1.<br>invoke function searchVector() directly.</p>
</li>
<li><p>Size of image library is larger than 1. Build ngraph, then search. Drop ngraph when program exit.</p>
<p> buildGraph()-&gt;optimizeGraph()-&gt;searchVector()</p>
</li>
<li><p>Size of image library is larger than 1. Build and save ngraph, then search.</p>
<p> buildGraph()-&gt;saveGraph()-&gt;optimizeGraph()-&gt;searchVector()</p>
</li>
<li><p>Size of image library is larger than 1. Load ngraph from disk, then search. Image library should remain the same when ngraph was generated.</p>
<p> loadGraph()-&gt;optimizeGraph()-&gt;searchVector()</p>
</li>
</ol>
<h3 id="Invoke-Method"><a href="#Invoke-Method" class="headerlink" title="Invoke Method"></a>Invoke Method</h3><h4 id="Example-Code-1st-Size-of-image-library-equals-1-Invoke-function-searchVector-directly-to-accomplish-face-verification-1-1-task"><a href="#Example-Code-1st-Size-of-image-library-equals-1-Invoke-function-searchVector-directly-to-accomplish-face-verification-1-1-task" class="headerlink" title="Example Code 1st: Size of image library equals 1. Invoke function searchVector() directly to accomplish face verification(1:1) task."></a>Example Code 1st: Size of image library equals 1. Invoke function searchVector() directly to accomplish face verification(1:1) task.</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Irisvian/IrisvianSearch.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> glasssix::Irisvian;</span><br><span class="line"></span><br><span class="line"><span class="comment">//fill baseData and queryData from files</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="keyword">static</span> <span class="title">loadData</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* filename, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt; &amp;baseData, <span class="keyword">unsigned</span> baseNumItem,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt; &amp;queryData, <span class="keyword">unsigned</span> queryNumItem, <span class="keyword">unsigned</span> dim)</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="built_in">std</span>::ifstream <span class="title">in</span><span class="params">(filename, <span class="built_in">std</span>::ios::in | <span class="built_in">std</span>::ios::binary)</span></span>;</span><br><span class="line">	<span class="keyword">if</span> (!in.is_open()) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"open file error"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>; <span class="built_in">exit</span>(<span class="number">-1</span>); &#125;</span><br><span class="line">	in.seekg(<span class="number">0</span>, <span class="built_in">std</span>::ios::beg);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; baseNumItem; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">float</span> *temp_data = (<span class="keyword">float</span>*)<span class="built_in">malloc</span>(dim * <span class="keyword">sizeof</span>(<span class="keyword">float</span>));</span><br><span class="line">		in.<span class="built_in">read</span>((<span class="keyword">char</span>*)(temp_data), dim * <span class="keyword">sizeof</span>(<span class="keyword">float</span>));</span><br><span class="line">		baseData.push_back(<span class="keyword">const_cast</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt;(temp_data));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; queryNumItem; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">float</span> *temp_data = (<span class="keyword">float</span>*)<span class="built_in">malloc</span>(dim * <span class="keyword">sizeof</span>(<span class="keyword">float</span>));</span><br><span class="line">		in.<span class="built_in">read</span>((<span class="keyword">char</span>*)(temp_data), dim * <span class="keyword">sizeof</span>(<span class="keyword">float</span>));</span><br><span class="line">		queryData.push_back(<span class="keyword">const_cast</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt;(temp_data));</span><br><span class="line">	&#125;</span><br><span class="line">	in.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt; baseData;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt; queryData;</span><br><span class="line">    <span class="keyword">unsigned</span> baseNum = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> queryNum = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> dimension = <span class="number">512</span>;</span><br><span class="line">	<span class="built_in">string</span> resultPath = <span class="string">"./result_"</span> + to_string(dimension) + <span class="string">"_"</span> + to_string(baseNum) + <span class="string">".bin"</span>;</span><br><span class="line">    <span class="built_in">string</span> sourceDataPath = <span class="string">"./map512.bin"</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//fill baseData and queryData</span></span><br><span class="line">    loadData(sourceDataPath.c_str(), baseData, baseNum, queryData, queryNum, dimension);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">unsigned</span> topK = <span class="number">1</span>;<span class="comment">//topK cannot exceed the total number in baseData</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">unsigned</span>&gt;&gt; returnIDs;<span class="comment">//face IDs returned，returnIDs.size() = queryNum, returnIDs[i].size()=topK</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt;&gt; returnDistancesInPercentage;<span class="comment">//similarity,returnDistancesInPercentage.size()=queryNum,returnDistancesInPercentage[i].size()=topK</span></span><br><span class="line">    </span><br><span class="line">	<span class="function">IrisvianSearch <span class="title">oSearch</span><span class="params">(&amp;baseData, dimension)</span></span>;</span><br><span class="line">    oSearch.searchVector(&amp;queryData, topK, returnIDs, returnDistancesInPercentage);</span><br><span class="line">    oSearch.saveResult(resultPath, returnIDs);<span class="comment">//only face IDs are saved, similarity ignored </span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Example-Code-2nd：Size-of-image-library-is-larger-than-1-Build-ngraph-then-search-Drop-ngraph-when-program-exit"><a href="#Example-Code-2nd：Size-of-image-library-is-larger-than-1-Build-ngraph-then-search-Drop-ngraph-when-program-exit" class="headerlink" title="Example Code 2nd：Size of image library is larger than 1. Build ngraph, then search. Drop ngraph when program exit."></a>Example Code 2nd：Size of image library is larger than 1. Build ngraph, then search. Drop ngraph when program exit.</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Irisvian/IrisvianSearch.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> glasssix::Irisvian;</span><br><span class="line"></span><br><span class="line"><span class="comment">//fill baseData and queryData from files, erase function body for simplicity</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="keyword">static</span> <span class="title">loadData</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* filename, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt; &amp;baseData, <span class="keyword">unsigned</span> baseNumItem,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt; &amp;queryData, <span class="keyword">unsigned</span> queryNumItem, <span class="keyword">unsigned</span> dim)</span> </span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt; baseData;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt; queryData;</span><br><span class="line">    <span class="keyword">unsigned</span> baseNum = <span class="number">100000</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> queryNum = <span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> dimension = <span class="number">512</span>;</span><br><span class="line">	<span class="built_in">string</span> resultPath = <span class="string">"./result_"</span> + to_string(dimension) + <span class="string">"_"</span> + to_string(baseNum) + <span class="string">".bin"</span>;</span><br><span class="line">    <span class="built_in">string</span> sourceDataPath = <span class="string">"./map512.bin"</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//fill baseData and queryData</span></span><br><span class="line">    loadData(sourceDataPath.c_str(), baseData, baseNum, queryData, queryNum, dimension);</span><br><span class="line">    </span><br><span class="line">	<span class="comment">//construct with both baseData and dimension</span></span><br><span class="line">    <span class="function">IrisvianSearch <span class="title">oSearch</span><span class="params">(&amp;baseData, dimension)</span></span>;</span><br><span class="line">	oSearch.buildGraph();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">////also we can construct with dimension, then import baseData when buildGraph()</span></span><br><span class="line">	<span class="comment">//IrisvianSearch oSearch(dimension);</span></span><br><span class="line">	<span class="comment">//oSearch.buildGraph(&amp;baseData);</span></span><br><span class="line">	</span><br><span class="line">    <span class="keyword">unsigned</span> topK = <span class="number">10</span>;<span class="comment">//topK cannot exceed the total number in baseData</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">unsigned</span>&gt;&gt; returnIDs;<span class="comment">//face IDs returned，returnIDs.size() = queryNum, returnIDs[i].size()=topK</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt;&gt; returnDistancesInPercentage;<span class="comment">//similarity,returnDistancesInPercentage.size()=queryNum,returnDistancesInPercentage[i].size()=topK</span></span><br><span class="line">    </span><br><span class="line">	oSearch.optimizeGraph();</span><br><span class="line">    oSearch.searchVector(&amp;queryData, topK, returnIDs, returnDistancesInPercentage);</span><br><span class="line">    oSearch.saveResult(resultPath, returnIDs);<span class="comment">//only face IDs are saved, similarity ignored</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Example-Code-3rd-Size-of-image-library-is-larger-than-1-Build-and-save-ngraph-then-search"><a href="#Example-Code-3rd-Size-of-image-library-is-larger-than-1-Build-and-save-ngraph-then-search" class="headerlink" title="Example Code 3rd: Size of image library is larger than 1. Build and save ngraph, then search."></a>Example Code 3rd: Size of image library is larger than 1. Build and save ngraph, then search.</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Irisvian/IrisvianSearch.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> glasssix::Irisvian;</span><br><span class="line"></span><br><span class="line"><span class="comment">//fill baseData and queryData from files, erase function body for simplicity</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="keyword">static</span> <span class="title">loadData</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* filename, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt; &amp;baseData, <span class="keyword">unsigned</span> baseNumItem,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt; &amp;queryData, <span class="keyword">unsigned</span> queryNumItem, <span class="keyword">unsigned</span> dim)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt; baseData;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt; queryData;</span><br><span class="line">    <span class="keyword">unsigned</span> baseNum = <span class="number">100000</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> queryNum = <span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> dimension = <span class="number">512</span>;</span><br><span class="line">	<span class="built_in">string</span> nGraphPath = <span class="string">"./ngraph_"</span> + to_string(dimension) + <span class="string">"_"</span> + to_string(baseNum) + <span class="string">".bin"</span>;</span><br><span class="line">	<span class="built_in">string</span> baseDataSavePath = <span class="string">"./baseData_"</span> + to_string(dimension) + <span class="string">"_"</span> + to_string(baseNum) + <span class="string">".bin"</span>;</span><br><span class="line">	<span class="built_in">string</span> resultPath = <span class="string">"./result_"</span> + to_string(dimension) + <span class="string">"_"</span> + to_string(baseNum) + <span class="string">".bin"</span>;</span><br><span class="line">    <span class="built_in">string</span> sourceDataPath = <span class="string">"./map512.bin"</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//fill baseData and queryData</span></span><br><span class="line">    loadData(sourceDataPath.c_str(), baseData, baseNum, queryData, queryNum, dimension);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//construct with both baseData and dimension</span></span><br><span class="line">    <span class="function">IrisvianSearch <span class="title">oSearch</span><span class="params">(&amp;baseData, dimension)</span></span>;</span><br><span class="line">	oSearch.buildGraph();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">////also we can construct with dimension, then import baseData when buildGraph()</span></span><br><span class="line">	<span class="comment">//IrisvianSearch oSearch(dimension);</span></span><br><span class="line">	<span class="comment">//oSearch.buildGraph(&amp;baseData);</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//save both ngraph and baseData, before invoke optimizeGraph()</span></span><br><span class="line">	oSearch.saveGraph(nGraphPath, baseDataSavePath);</span><br><span class="line">	</span><br><span class="line">    <span class="comment">////also we can only save ngraph, before invoke optimizeGraph()</span></span><br><span class="line">	<span class="comment">//oSearch.saveGraph(nGraphPath);</span></span><br><span class="line">	</span><br><span class="line">    <span class="keyword">unsigned</span> topK = <span class="number">10</span>;<span class="comment">//topK cannot exceed the total number in baseData</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">unsigned</span>&gt;&gt; returnIDs;<span class="comment">//face IDs returned，returnIDs.size() = queryNum, returnIDs[i].size()=topK</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt;&gt; returnDistancesInPercentage;<span class="comment">//similarity,returnDistancesInPercentage.size()=queryNum,returnDistancesInPercentage[i].size()=topK</span></span><br><span class="line">    </span><br><span class="line">	oSearch.optimizeGraph();</span><br><span class="line">    oSearch.searchVector(&amp;queryData, topK, returnIDs, returnDistancesInPercentage);</span><br><span class="line">    oSearch.saveResult(resultPath, returnIDs);<span class="comment">//only face IDs are saved, similarity ignored </span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Example-Code-4th-Size-of-image-library-is-larger-than-1-Load-ngraph-from-disk-then-search-Image-library-should-remain-the-same-when-ngraph-was-generated"><a href="#Example-Code-4th-Size-of-image-library-is-larger-than-1-Load-ngraph-from-disk-then-search-Image-library-should-remain-the-same-when-ngraph-was-generated" class="headerlink" title="Example Code 4th: Size of image library is larger than 1. Load ngraph from disk, then search. Image library should remain the same when ngraph was generated."></a>Example Code 4th: Size of image library is larger than 1. Load ngraph from disk, then search. Image library should remain the same when ngraph was generated.</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Irisvian/IrisvianSearch.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> glasssix::Irisvian;</span><br><span class="line"></span><br><span class="line"><span class="comment">//fill baseData or queryData from files</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="keyword">static</span> <span class="title">loadData</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* filename, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt; &amp;data, <span class="keyword">unsigned</span> numItem, <span class="keyword">unsigned</span> dim)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function"><span class="built_in">std</span>::ifstream <span class="title">in</span><span class="params">(filename, <span class="built_in">std</span>::ios::in | <span class="built_in">std</span>::ios::binary)</span></span>;</span><br><span class="line">	<span class="keyword">if</span> (!in.is_open())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"open file error"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>; <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	in.seekg(<span class="number">0</span>, <span class="built_in">std</span>::ios::beg);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numItem; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">float</span> *temp_data = (<span class="keyword">float</span>*)<span class="built_in">malloc</span>(dim * <span class="keyword">sizeof</span>(<span class="keyword">float</span>));</span><br><span class="line">		in.<span class="built_in">read</span>((<span class="keyword">char</span>*)(temp_data), dim * <span class="keyword">sizeof</span>(<span class="keyword">float</span>));</span><br><span class="line">		data.push_back(<span class="keyword">const_cast</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt;(temp_data));</span><br><span class="line">	&#125;</span><br><span class="line">	in.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt; baseData;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt; queryData;</span><br><span class="line">    <span class="keyword">unsigned</span> baseNum = <span class="number">100000</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> queryNum = <span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> dimension = <span class="number">512</span>;</span><br><span class="line">	<span class="built_in">string</span> nGraphPath = <span class="string">"./ngraph_"</span> + to_string(dimension) + <span class="string">"_"</span> + to_string(baseNum) + <span class="string">".bin"</span>;</span><br><span class="line">	<span class="built_in">string</span> baseDataSavePath = <span class="string">"./baseData_"</span> + to_string(dimension) + <span class="string">"_"</span> + to_string(baseNum) + <span class="string">".bin"</span>;</span><br><span class="line">	<span class="built_in">string</span> resultPath = <span class="string">"./result_"</span> + to_string(dimension) + <span class="string">"_"</span> + to_string(baseNum) + <span class="string">".bin"</span>;</span><br><span class="line">	<span class="built_in">string</span> sourceDataPath = <span class="string">"./map512.bin"</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//fill baseData and queryData</span></span><br><span class="line">    loadData(baseDataSavePath.c_str(), baseData, baseNum, dimension);</span><br><span class="line">	loadData(sourceDataPath.c_str(), queryData, queryNum, dimension);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//also we can construct with dimension, then import baseData when loadGraph()</span></span><br><span class="line">	<span class="function">IrisvianSearch <span class="title">oSearch</span><span class="params">(dimension)</span></span>;</span><br><span class="line">	oSearch.loadGraph(nGraphPath, baseData);</span><br><span class="line">	</span><br><span class="line">    <span class="comment">////construct with both baseData and dimension</span></span><br><span class="line">    <span class="comment">//IrisvianSearch oSearch(&amp;baseData, dimension);</span></span><br><span class="line">    <span class="comment">//oSearch.loadGraph(nGraphPath);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> topK = <span class="number">10</span>;<span class="comment">//topK cannot exceed the total number in baseData</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">unsigned</span>&gt;&gt; returnIDs;<span class="comment">//face IDs returned，returnIDs.size() = queryNum, returnIDs[i].size()=topK</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt;&gt; returnDistancesInPercentage;<span class="comment">//similarity,returnDistancesInPercentage.size()=queryNum,returnDistancesInPercentage[i].size()=topK</span></span><br><span class="line">    </span><br><span class="line">	oSearch.optimizeGraph();</span><br><span class="line">    oSearch.searchVector(&amp;queryData, topK, returnIDs, returnDistancesInPercentage);</span><br><span class="line">    oSearch.saveResult(resultPath, returnIDs);<span class="comment">//only face IDs are saved, similarity ignored </span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="Class-Description-IrisvianSearch"><a href="#Class-Description-IrisvianSearch" class="headerlink" title="Class Description: IrisvianSearch"></a>Class Description: IrisvianSearch</h4><h5 id="Member-FunctionIrisvianSearch-int-dimension"><a href="#Member-FunctionIrisvianSearch-int-dimension" class="headerlink" title="Member FunctionIrisvianSearch(int dimension);"></a>Member Function<code>IrisvianSearch(int dimension);</code></h5><p>Capability: Construct class Index with dimension</p>
<table>
<thead>
<tr>
<th align="center">Parameter</th>
<th align="center">Parameter Type</th>
<th align="center">Value</th>
<th align="center">Illustration</th>
<th align="center">Remark</th>
</tr>
</thead>
<tbody><tr>
<td align="center">dimension</td>
<td align="center">int</td>
<td align="center">length of single face feature vector</td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<h5 id="Member-FunctionIrisvianSearch-const-std-vector-lt-const-float-gt-baseData-int-dimension"><a href="#Member-FunctionIrisvianSearch-const-std-vector-lt-const-float-gt-baseData-int-dimension" class="headerlink" title="Member FunctionIrisvianSearch(const std::vector&lt;const float*&gt; *baseData, int dimension);"></a>Member Function<code>IrisvianSearch(const std::vector&lt;const float*&gt; *baseData, int dimension);</code></h5><p>Capability: Construct class Index with baseData and dimension</p>
<table>
<thead>
<tr>
<th align="center">Parameter</th>
<th align="center">Parameter Type</th>
<th align="center">Value</th>
<th align="center">Illustration</th>
<th align="center">Remark</th>
</tr>
</thead>
<tbody><tr>
<td align="center">baseData</td>
<td align="center">const std::vector&lt;const float*&gt; *</td>
<td align="center">user input</td>
<td align="center">image library</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">dimension</td>
<td align="center">int</td>
<td align="center">length of single face feature vector</td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<h5 id="Member-FunctionBuildGraph"><a href="#Member-FunctionBuildGraph" class="headerlink" title="Member FunctionBuildGraph();"></a>Member Function<code>BuildGraph();</code></h5><p>Capability: build nGraph</p>
<h5 id="Member-FunctionBuildGraph-const-std-vector-lt-const-float-gt-baseData"><a href="#Member-FunctionBuildGraph-const-std-vector-lt-const-float-gt-baseData" class="headerlink" title="Member FunctionBuildGraph(const std::vector&lt;const float*&gt; *baseData);"></a>Member Function<code>BuildGraph(const std::vector&lt;const float*&gt; *baseData);</code></h5><p>Capability: build nGraph with baseData</p>
<table>
<thead>
<tr>
<th align="center">Parameter</th>
<th align="center">Parameter Type</th>
<th align="center">Value</th>
<th align="center">Illustration</th>
<th align="center">Remark</th>
</tr>
</thead>
<tbody><tr>
<td align="center">baseData</td>
<td align="center">const std::vector&lt;const float*&gt; *</td>
<td align="center">user input</td>
<td align="center">image library</td>
<td align="center"></td>
</tr>
</tbody></table>
<h5 id="Member-Functionvoid-SaveGraph-const-char-graphPath"><a href="#Member-Functionvoid-SaveGraph-const-char-graphPath" class="headerlink" title="Member Functionvoid SaveGraph(const char *graphPath);"></a>Member Function<code>void SaveGraph(const char *graphPath);</code></h5><p>Capability: save nGraph for future use</p>
<table>
<thead>
<tr>
<th align="center">Parameter</th>
<th align="center">Parameter Type</th>
<th align="center">Value</th>
<th align="center">Illustration</th>
<th align="center">Remark</th>
</tr>
</thead>
<tbody><tr>
<td align="center">graphPath</td>
<td align="center">const char *</td>
<td align="center">user input</td>
<td align="center">path of nGraph to be saved</td>
<td align="center"></td>
</tr>
</tbody></table>
<h5 id="Member-Functionvoid-SaveGraph-const-char-graphPath-const-char-basedataPath"><a href="#Member-Functionvoid-SaveGraph-const-char-graphPath-const-char-basedataPath" class="headerlink" title="Member Functionvoid SaveGraph(const char *graphPath, const char *basedataPath);"></a>Member Function<code>void SaveGraph(const char *graphPath, const char *basedataPath);</code></h5><p>Capability: save nGraph and baseData for future use</p>
<table>
<thead>
<tr>
<th align="center">Parameter</th>
<th align="center">Parameter Type</th>
<th align="center">Value</th>
<th align="center">Illustration</th>
<th align="center">Remark</th>
</tr>
</thead>
<tbody><tr>
<td align="center">graphPath</td>
<td align="center">const char *</td>
<td align="center">user input</td>
<td align="center">path of nGraph to be saved</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">basedataPath</td>
<td align="center">const char *</td>
<td align="center">user input</td>
<td align="center">path of baseData to be saved</td>
<td align="center"></td>
</tr>
</tbody></table>
<h5 id="Member-Functionvoid-LoadGraph-const-char-graphPath"><a href="#Member-Functionvoid-LoadGraph-const-char-graphPath" class="headerlink" title="Member Functionvoid LoadGraph(const char* graphPath);"></a>Member Function<code>void LoadGraph(const char* graphPath);</code></h5><p>Capability: Load nGraph from disk before search</p>
<table>
<thead>
<tr>
<th align="center">Parameter</th>
<th align="center">Parameter Type</th>
<th align="center">Value</th>
<th align="center">Illustration</th>
<th align="center">Remark</th>
</tr>
</thead>
<tbody><tr>
<td align="center">graphPath</td>
<td align="center">const char *</td>
<td align="center">user input</td>
<td align="center">path of nGraph</td>
<td align="center"></td>
</tr>
</tbody></table>
<h5 id="Member-Functionvoid-LoadGraph-const-char-graphPath-const-char-basedataPath"><a href="#Member-Functionvoid-LoadGraph-const-char-graphPath-const-char-basedataPath" class="headerlink" title="Member Functionvoid LoadGraph(const char* graphPath, const char *basedataPath);"></a>Member Function<code>void LoadGraph(const char* graphPath, const char *basedataPath);</code></h5><p>Capability: Load nGraph and baseData from disk before search</p>
<table>
<thead>
<tr>
<th align="center">Parameter</th>
<th align="center">Parameter Type</th>
<th align="center">Value</th>
<th align="center">Illustration</th>
<th align="center">Remark</th>
</tr>
</thead>
<tbody><tr>
<td align="center">graphPath</td>
<td align="center">const char *</td>
<td align="center">user input</td>
<td align="center">path of nGraph</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">basedataPath</td>
<td align="center">const char *</td>
<td align="center">user input</td>
<td align="center">path of baseData</td>
<td align="center"></td>
</tr>
</tbody></table>
<h5 id="Member-Functionvoid-optimizeGraph"><a href="#Member-Functionvoid-optimizeGraph" class="headerlink" title="Member Functionvoid optimizeGraph();"></a>Member Function<code>void optimizeGraph();</code></h5><p>Capability: optimize nGraph before search</p>
<h5 id="Member-Functionvoid-searchVector-const-vector-lt-const-float-gt-queryData-unsigned-topK-std-vector-lt-std-vector-lt-unsigned-gt-gt-amp-returnIDs-std-vector-lt-std-vector-lt-float-gt-gt-amp-returnDistancesInPercentage"><a href="#Member-Functionvoid-searchVector-const-vector-lt-const-float-gt-queryData-unsigned-topK-std-vector-lt-std-vector-lt-unsigned-gt-gt-amp-returnIDs-std-vector-lt-std-vector-lt-float-gt-gt-amp-returnDistancesInPercentage" class="headerlink" title="Member Functionvoid searchVector(const vector&lt;const float*&gt;* queryData, unsigned topK, std::vector&lt;std::vector&lt;unsigned&gt;&gt; &amp;returnIDs, std::vector&lt;std::vector&lt;float&gt;&gt; &amp;returnDistancesInPercentage);"></a>Member Function<code>void searchVector(const vector&lt;const float*&gt;* queryData, unsigned topK, std::vector&lt;std::vector&lt;unsigned&gt;&gt; &amp;returnIDs, std::vector&lt;std::vector&lt;float&gt;&gt; &amp;returnDistancesInPercentage);</code></h5><p>Capability: execute search task</p>
<table>
<thead>
<tr>
<th align="center">Parameter</th>
<th align="center">Parameter Type</th>
<th align="center">Value</th>
<th align="center">Illustration</th>
<th align="center">Remark</th>
</tr>
</thead>
<tbody><tr>
<td align="center">queryData</td>
<td align="center">const vector&lt;const float<em>&gt;</em></td>
<td align="center">user input</td>
<td align="center">faces to be searched</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">topK</td>
<td align="center">unsigned</td>
<td align="center">user input</td>
<td align="center">return topK most similar results for each face</td>
<td align="center">topK should be less than baseNum. If only 1 image exists in image library, execute face verification task(1:1 search), and topK will be useless in this situation.</td>
</tr>
<tr>
<td align="center">returnIDs</td>
<td align="center">std::vector&lt;std::vector<unsigned>&gt;</td>
<td align="center">sequence number of baseData, such as 0,1,2,3···</td>
<td align="center">IDs for topK most similar results in baseData</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">returnDistancesInPercentage</td>
<td align="center">std::vector&lt;std::vector<float>&gt;</td>
<td align="center">float value between 0 and 1</td>
<td align="center">similarity(L2,Cosine…) of returned topK most similar results</td>
<td align="center"></td>
</tr>
</tbody></table>
<h5 id="Member-Functionvoid-SaveResult-const-char-resultPath-std-vector-lt-std-vector-lt-unsigned-gt-gt-amp-returnIDs"><a href="#Member-Functionvoid-SaveResult-const-char-resultPath-std-vector-lt-std-vector-lt-unsigned-gt-gt-amp-returnIDs" class="headerlink" title="Member Functionvoid SaveResult(const char* resultPath, std::vector&lt;std::vector&lt;unsigned&gt; &gt; &amp;returnIDs);"></a>Member Function<code>void SaveResult(const char* resultPath, std::vector&lt;std::vector&lt;unsigned&gt; &gt; &amp;returnIDs);</code></h5><p>Capability: save IDs of topK most similar results</p>
<table>
<thead>
<tr>
<th align="center">Parameter</th>
<th align="center">Parameter Type</th>
<th align="center">Value</th>
<th align="center">Illustration</th>
<th align="center">Remark</th>
</tr>
</thead>
<tbody><tr>
<td align="center">resultPath</td>
<td align="center">const char*</td>
<td align="center">user input</td>
<td align="center">path of returnIDs to be saved</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">returnIDs</td>
<td align="center">std::vector&lt;std::vector<unsigned>&gt;</td>
<td align="center">sequence number of baseData, such as 0,1,2,3···</td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<h5 id="Member-Functionvoid-SaveResult-std-string-resultPath-std-vector-lt-std-vector-lt-unsigned-gt-gt-amp-returnIDs"><a href="#Member-Functionvoid-SaveResult-std-string-resultPath-std-vector-lt-std-vector-lt-unsigned-gt-gt-amp-returnIDs" class="headerlink" title="Member Functionvoid SaveResult(std::string resultPath, std::vector&lt;std::vector&lt;unsigned&gt; &gt; &amp;returnIDs);"></a>Member Function<code>void SaveResult(std::string resultPath, std::vector&lt;std::vector&lt;unsigned&gt; &gt; &amp;returnIDs);</code></h5><p>Capability: save IDs of topK most similar results</p>
<table>
<thead>
<tr>
<th align="center">Parameter</th>
<th align="center">Parameter Type</th>
<th align="center">Value</th>
<th align="center">Illustration</th>
<th align="center">Remark</th>
</tr>
</thead>
<tbody><tr>
<td align="center">resultPath</td>
<td align="center">std::string</td>
<td align="center">user input</td>
<td align="center">path of returnIDs to be saved</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">returnIDs</td>
<td align="center">std::vector&lt;std::vector<unsigned>&gt;</td>
<td align="center">sequence number of baseData, such as 0,1,2,3···</td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<h4 id="Irisvian-Performance"><a href="#Irisvian-Performance" class="headerlink" title="Irisvian Performance"></a>Irisvian Performance</h4><p>Test 128-dimension feature vector on platform i7-8700K, with baseNum of 1K,2K,5K,10K,20K,50K,100K,200K,500K(k represents 1000), queryNum is one tenth of baseNum, return top 10 most similar results for each searched face. Accuracy is calculated by compare our results with time-consuming-brute-force results.</p>
<h5 id="Basic-Information-of-Test-Platform"><a href="#Basic-Information-of-Test-Platform" class="headerlink" title="Basic Information of Test Platform"></a>Basic Information of Test Platform</h5><table>
<thead>
<tr>
<th align="center">Item</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Operating System</td>
<td align="center">Windows 10 Enterprise 64bit</td>
</tr>
<tr>
<td align="center">Processor</td>
<td align="center">Intel(R) Core(TM) i7-8700K CPU @ 3.70GHz</td>
</tr>
<tr>
<td align="center">Core and Thread</td>
<td align="center">6 Cores and 12 Threads</td>
</tr>
<tr>
<td align="center">RAM</td>
<td align="center">32GB</td>
</tr>
<tr>
<td align="center">Compiler</td>
<td align="center">MSVC 19.5</td>
</tr>
<tr>
<td align="center">OpenMP</td>
<td align="center">Yes</td>
</tr>
<tr>
<td align="center">SIMD Instruction Set</td>
<td align="center">AVX2</td>
</tr>
</tbody></table>
<h5 id="Test-Report"><a href="#Test-Report" class="headerlink" title="Test Report"></a>Test Report</h5><table>
<thead>
<tr>
<th align="center">baseNum</th>
<th align="center">buildTime(s)</th>
<th align="center">searchTime(ms)</th>
<th align="center">accuracy(%)</th>
<th align="center">Peak Memory Usage(MB)</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1k</td>
<td align="center">0.080</td>
<td align="center">0.010</td>
<td align="center">100</td>
<td align="center">6</td>
</tr>
<tr>
<td align="center">2k</td>
<td align="center">0.141</td>
<td align="center">0.015</td>
<td align="center">100</td>
<td align="center">11</td>
</tr>
<tr>
<td align="center">5k</td>
<td align="center">0.493</td>
<td align="center">0.020</td>
<td align="center">99.92</td>
<td align="center">22</td>
</tr>
<tr>
<td align="center">10k</td>
<td align="center">0.828</td>
<td align="center">0.009</td>
<td align="center">100</td>
<td align="center">41</td>
</tr>
<tr>
<td align="center">20k</td>
<td align="center">1.733</td>
<td align="center">0.013</td>
<td align="center">99.96</td>
<td align="center">68</td>
</tr>
<tr>
<td align="center">50k</td>
<td align="center">4.845</td>
<td align="center">0.024</td>
<td align="center">99.56</td>
<td align="center">177</td>
</tr>
<tr>
<td align="center">100k</td>
<td align="center">20.261</td>
<td align="center">0.031</td>
<td align="center">99.80</td>
<td align="center">375</td>
</tr>
<tr>
<td align="center">200k</td>
<td align="center">71.380</td>
<td align="center">0.046</td>
<td align="center">99.95</td>
<td align="center">753</td>
</tr>
<tr>
<td align="center">500k</td>
<td align="center">221.486</td>
<td align="center">0.070</td>
<td align="center">98.85</td>
<td align="center">2008</td>
</tr>
</tbody></table>

        
      </div>
      
      
      
    </div>
    
    
    
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/1.gif"
                alt="GlasssixResearch" />
            
              <p class="site-author-name" itemprop="name">GlasssixResearch</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Glasssix" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:inlmouse@glasssix.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Face-Search-V1-0-TrialFaceSDK"><span class="nav-number">1.</span> <span class="nav-text">Face Search V1.0(TrialFaceSDK)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Capability-Introduction"><span class="nav-number">1.1.</span> <span class="nav-text">Capability Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Interface-Capability"><span class="nav-number">1.1.1.</span> <span class="nav-text">Interface Capability</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dependencied"><span class="nav-number">1.1.2.</span> <span class="nav-text">Dependencied</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Use-Cases"><span class="nav-number">1.2.</span> <span class="nav-text">Use Cases</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Invoke-Method"><span class="nav-number">1.3.</span> <span class="nav-text">Invoke Method</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-Code-1st-Size-of-image-library-equals-1-Invoke-function-searchVector-directly-to-accomplish-face-verification-1-1-task"><span class="nav-number">1.3.1.</span> <span class="nav-text">Example Code 1st: Size of image library equals 1. Invoke function searchVector() directly to accomplish face verification(1:1) task.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-Code-2nd：Size-of-image-library-is-larger-than-1-Build-ngraph-then-search-Drop-ngraph-when-program-exit"><span class="nav-number">1.3.2.</span> <span class="nav-text">Example Code 2nd：Size of image library is larger than 1. Build ngraph, then search. Drop ngraph when program exit.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-Code-3rd-Size-of-image-library-is-larger-than-1-Build-and-save-ngraph-then-search"><span class="nav-number">1.3.3.</span> <span class="nav-text">Example Code 3rd: Size of image library is larger than 1. Build and save ngraph, then search.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-Code-4th-Size-of-image-library-is-larger-than-1-Load-ngraph-from-disk-then-search-Image-library-should-remain-the-same-when-ngraph-was-generated"><span class="nav-number">1.3.4.</span> <span class="nav-text">Example Code 4th: Size of image library is larger than 1. Load ngraph from disk, then search. Image library should remain the same when ngraph was generated.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Class-Description-IrisvianSearch"><span class="nav-number">1.3.5.</span> <span class="nav-text">Class Description: IrisvianSearch</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Member-FunctionIrisvianSearch-int-dimension"><span class="nav-number">1.3.5.1.</span> <span class="nav-text">Member FunctionIrisvianSearch(int dimension);</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Member-FunctionIrisvianSearch-const-std-vector-lt-const-float-gt-baseData-int-dimension"><span class="nav-number">1.3.5.2.</span> <span class="nav-text">Member FunctionIrisvianSearch(const std::vector&lt;const float*&gt; *baseData, int dimension);</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Member-FunctionBuildGraph"><span class="nav-number">1.3.5.3.</span> <span class="nav-text">Member FunctionBuildGraph();</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Member-FunctionBuildGraph-const-std-vector-lt-const-float-gt-baseData"><span class="nav-number">1.3.5.4.</span> <span class="nav-text">Member FunctionBuildGraph(const std::vector&lt;const float*&gt; *baseData);</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Member-Functionvoid-SaveGraph-const-char-graphPath"><span class="nav-number">1.3.5.5.</span> <span class="nav-text">Member Functionvoid SaveGraph(const char *graphPath);</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Member-Functionvoid-SaveGraph-const-char-graphPath-const-char-basedataPath"><span class="nav-number">1.3.5.6.</span> <span class="nav-text">Member Functionvoid SaveGraph(const char *graphPath, const char *basedataPath);</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Member-Functionvoid-LoadGraph-const-char-graphPath"><span class="nav-number">1.3.5.7.</span> <span class="nav-text">Member Functionvoid LoadGraph(const char* graphPath);</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Member-Functionvoid-LoadGraph-const-char-graphPath-const-char-basedataPath"><span class="nav-number">1.3.5.8.</span> <span class="nav-text">Member Functionvoid LoadGraph(const char* graphPath, const char *basedataPath);</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Member-Functionvoid-optimizeGraph"><span class="nav-number">1.3.5.9.</span> <span class="nav-text">Member Functionvoid optimizeGraph();</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Member-Functionvoid-searchVector-const-vector-lt-const-float-gt-queryData-unsigned-topK-std-vector-lt-std-vector-lt-unsigned-gt-gt-amp-returnIDs-std-vector-lt-std-vector-lt-float-gt-gt-amp-returnDistancesInPercentage"><span class="nav-number">1.3.5.10.</span> <span class="nav-text">Member Functionvoid searchVector(const vector&lt;const float*&gt;* queryData, unsigned topK, std::vector&lt;std::vector&lt;unsigned&gt;&gt; &amp;returnIDs, std::vector&lt;std::vector&lt;float&gt;&gt; &amp;returnDistancesInPercentage);</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Member-Functionvoid-SaveResult-const-char-resultPath-std-vector-lt-std-vector-lt-unsigned-gt-gt-amp-returnIDs"><span class="nav-number">1.3.5.11.</span> <span class="nav-text">Member Functionvoid SaveResult(const char* resultPath, std::vector&lt;std::vector&lt;unsigned&gt; &gt; &amp;returnIDs);</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Member-Functionvoid-SaveResult-std-string-resultPath-std-vector-lt-std-vector-lt-unsigned-gt-gt-amp-returnIDs"><span class="nav-number">1.3.5.12.</span> <span class="nav-text">Member Functionvoid SaveResult(std::string resultPath, std::vector&lt;std::vector&lt;unsigned&gt; &gt; &amp;returnIDs);</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Irisvian-Performance"><span class="nav-number">1.3.6.</span> <span class="nav-text">Irisvian Performance</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Basic-Information-of-Test-Platform"><span class="nav-number">1.3.6.1.</span> <span class="nav-text">Basic Information of Test Platform</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Test-Report"><span class="nav-number">1.3.6.2.</span> <span class="nav-text">Test Report</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        

<div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
 


  <span class="author" itemprop="copyrightHolder">GlasssixResearch</span>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  Number of visitors:<span id="busuanzi_value_site_uv"></span>
</span>
</div> 
  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">650</span>
  
</div>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

  

<!-- 图片轮播js文件cdn -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>

<!-- 自定义的js文件 -->
<script type="text/javascript" src="/js/src/custom.js"></script>


</body>
</html>
